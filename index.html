<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll Novel Game</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts (Noto Serif JP for Novel look) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Serif JP', serif;
            background-color: #1a1a1a;
            color: #e5e5e5;
            margin: 0;
            overflow: hidden; /* Prevent body scroll, handle in app */
        }

        /* Hide scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .image-transition { transition: opacity 0.5s ease-in-out; }
        *:focus { outline: none; }

        /* Title Screen Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 1s ease-out forwards; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==========================================
        // „Åì„Åì„Å´ÊñáÁ´†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        // [img:Êï∞Â≠ó] „Çø„Ç∞„ÅßÁîªÂÉèÂàá„ÇäÊõø„Åà
        // ==========================================
        const novelTextRaw = `
[img:1]
„Åì„Çå„ÅØ„Çµ„É≥„Éó„É´„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Åß„Åô„ÄÇ
‰ªïÊßò„ÇíÂ§âÊõ¥„Åó„ÄÅ‰ªªÊÑè„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„ÅßÁîªÂÉè„ÇíÂàá„ÇäÊõø„Åà„Çâ„Çå„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åó„Åü„ÄÇ
ÊñáÁ´†„ÅÆ‰∏≠„Å´„Äå„Çø„Ç∞„Äç„ÇíÂüã„ÇÅËæº„ÇÄ„Åì„Å®„ÅßÂà∂Âæ°„Åó„Åæ„Åô„ÄÇ

‰æã„Åà„Å∞„ÄÅ„Åì„ÅÆË°å„Åæ„Åß„ÅØ„Äå1.png„Äç„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ
Ê¨°„ÅÆË°å„ÅßÊòéÁ§∫ÁöÑ„Å´„Äå2.png„Äç„Å∏Âàá„ÇäÊõø„Åà„Å¶„Åø„Åæ„Åô„ÄÇ

[img:2]
„ÅØ„ÅÑ„ÄÅ„Åì„Åì„ÅßÁîªÂÉè„Åå„Äå2.png„Äç„Å´Â§â„Çè„Çä„Åæ„Åó„Åü„ÄÇ
Ë°åÊï∞„Å´Èñ¢‰øÇ„Å™„Åè„ÄÅÂ•Ω„Åç„Å™„Çø„Ç§„Éü„É≥„Ç∞„ÅßÊºîÂá∫ÂèØËÉΩ„Åß„Åô„ÄÇ

„Çø„Ç∞„ÅØ [img:2] „ÅÆ„Çà„ÅÜ„Å´Êõ∏„Åç„Åæ„Åô„ÄÇ
ÔºàÁîªÈù¢‰∏ä„Å´„ÅØ„Çø„Ç∞„ÅÆÊñáÂ≠ó„ÅØË°®Á§∫„Åï„Çå„Åæ„Åõ„ÇìÔºâ

„Åó„Å∞„Çâ„Åè„Åì„ÅÆ„Åæ„ÅæË™≠„ÅøÈÄ≤„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
ÊñáÁ´†„ÅÆÈï∑„Åï„ÇÇËá™Áî±„Åß„Åô„ÄÇ
Áü≠„ÅÑË°å„Åß„ÇÇ„ÄÅÈï∑„ÅÑË°å„Åß„ÇÇÊßã„ÅÑ„Åæ„Åõ„Çì„ÄÇ

„Åï„Å¶„ÄÅÊ¨°„ÅØ‰∏ÄÊ∞ó„Å´„Äå5.png„Äç„Å´È£õ„Å∞„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ
Ê∫ñÂÇô„ÅØ„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü

[img:5]
ÁîªÂÉè„Åå„Äå5.png„Äç„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ
„Åì„ÅÆ„Çà„ÅÜ„Å´„ÄÅÂ†¥Èù¢Ëª¢Êèõ„ÇÑ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÅÆÁôªÂ†¥„Å´Âêà„Çè„Åõ„Å¶
Ëá™Áî±„Å´ÁîªÂÉè„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

„ÇÇ„Å°„Çç„ÇìÁîªÂÉè„Éï„Ç°„Ç§„É´„ÅØ
„Äå1.png„Äç„Äå2.png„Äç„Äå5.png„Äç„ÅÆ„Çà„ÅÜ„Å´
ÊåáÂÆö„Åó„ÅüÁï™Âè∑„Å´ÂØæÂøú„Åô„Çã„Éï„Ç°„Ç§„É´„ÇíÁî®ÊÑè„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

[img:3]
ÁîªÂÉè„Çí„Äå3.png„Äç„Å´Êàª„Åô„Åì„Å®„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ
ÂõûÊÉ≥„Ç∑„Éº„É≥„Å™„Å©„Åß‰Ωø„Åà„Åæ„Åô„Å≠„ÄÇ

Ôºà‰ª•‰∏ã„ÄÅ„Çπ„ÇØ„É≠„Éº„É´„ÉÜ„Çπ„ÉàÁî®„ÅÆ„ÉÄ„Éü„Éº„ÉÜ„Ç≠„Çπ„ÉàÔºâ
Ê∑±„ÅÑÊ£Æ„ÅÆ‰∏≠„Å´Ëø∑„ÅÑËæº„Çì„Å†„Çà„ÅÜ„Å™Èùô„Åë„Åï„ÄÇ
ÈÅ†„Åè„ÅßÈ≥•„ÅÆÈ≥¥„ÅçÂ£∞„ÅåËÅû„Åì„Åà„ÇãÊ∞ó„Åå„Åó„Åæ„Åô„ÄÇ
Ë∂≥ÂÖÉ„ÅÆÊûØ„ÇåËëâ„ÇíË∏è„ÇÄÈü≥„ÄÇ
„Ç´„Çµ„ÉÉ„ÄÅ„Ç´„Çµ„ÉÉ„Å®„ÅÑ„ÅÜÈü≥„ÅåÈüø„Åç„Åæ„Åô„ÄÇ
„ÅÇ„Å™„Åü„ÅØ‰∏çÂÆâ„Å®ÊúüÂæÖ„ÇíËÉ∏„Å´Êä±„Åç„Å™„Åå„Çâ„ÄÅ
„Åï„Çâ„Å´Â••„Å∏„Å®ÈÄ≤„Çì„Åß„ÅÑ„Åç„Åæ„Åô„ÄÇ

[img:4]
Êú®Êºè„ÇåÊó•„ÅåÂ∑Æ„ÅóËæº„ÇÄÂ†¥ÊâÄ„Å´Âá∫„Åæ„Åó„Åü„ÄÇ
„Åù„Åì„Å´„ÅØÂè§„Å≥„ÅüÊ¥ãÈ§®„ÅåÂª∫„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
Ê¥ãÈ§®„ÅÆÊââ„ÅØÈáç„Åè„ÄÅÂÜ∑„Åü„ÅÑ„ÄÇ
„ÇÆ„Ç£„Ç£„Å®„ÅÑ„ÅÜÈü≥„Å®ÂÖ±„Å´Êââ„ÅåÈñã„Åç„Åæ„Åô„ÄÇ
‰∏≠„ÅØËñÑÊöó„Åè„ÄÅÂüÉ„ÅÆÂåÇ„ÅÑ„Åå„Åó„Åæ„Åô„ÄÇ

[img:1]
Áâ©Ë™û„ÅØÂÜíÈ†≠„ÅÆ„Ç∑„Éº„É≥„Å∏Êàª„Çä„Åæ„Åô„ÄÇ
„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Çí‰Ωø„Åà„Å∞„ÄÅ
„Çà„ÇäËá™Áî±„Å™ÊºîÂá∫„ÅÆ„Éé„Éô„É´„Ç≤„Éº„É†„Åå‰Ωú„Çå„Åæ„Åô„ÄÇ
Ê•Ω„Åó„Çì„Åß„Åè„Å†„Åï„ÅÑÔºÅ
`;

        // „ÉÜ„Ç≠„Çπ„ÉàËß£ÊûêÈñ¢Êï∞
        const parseNovelText = (text) => {
            const rawLines = text.trim().split('\n');
            let currentId = 1; 
            
            return rawLines.map(line => {
                const match = line.match(/\[img:(\d+)\]/);
                if (match) {
                    currentId = parseInt(match[1], 10);
                }
                const cleanText = line.replace(/\[img:\d+\]/g, '');
                return { text: cleanText, imageId: currentId };
            });
        };

        // --- „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà: „Çø„Ç§„Éà„É´ÁîªÈù¢ ---
        const TitleScreen = ({ onStart }) => {
            // ÁîªÂÉè„É≠„Éº„ÉâÁä∂ÊÖãÁÆ°ÁêÜ
            const [backLoaded, setBackLoaded] = useState(false);
            const [backError, setBackError] = useState(false);
            const [topLoaded, setTopLoaded] = useState(false);
            const [topError, setTopError] = useState(false);

            useEffect(() => {
                // back.png Ë™≠„ÅøËæº„Åø
                const imgBack = new Image();
                imgBack.src = "back.png";
                imgBack.onload = () => setBackLoaded(true);
                imgBack.onerror = () => setBackError(true);

                // top.png Ë™≠„ÅøËæº„Åø
                const imgTop = new Image();
                imgTop.src = "top.png";
                imgTop.onload = () => setTopLoaded(true);
                imgTop.onerror = () => setTopError(true);
            }, []);

            return (
                <div className="relative w-full h-screen bg-black flex flex-col items-center justify-center overflow-hidden">
                    {/* Layer 0: Background (back.png) - Full Screen */}
                    <div className="absolute inset-0 z-0">
                         {backError ? (
                            <div className="w-full h-full flex items-center justify-center bg-gray-900 text-gray-700">
                                <span>back.png Not Found</span>
                            </div>
                        ) : (
                            <img 
                                src="back.png" 
                                alt="Title Background Base" 
                                className={`w-full h-full object-cover transition-opacity duration-1000 ${backLoaded ? 'opacity-100' : 'opacity-0'}`}
                            />
                        )}
                    </div>

                    {/* Layer 1: Foreground Image (top.png) - 1„Å§Ââç„ÅÆ‰ªïÊßò„Å´Êàª„Åô (Fullscreen overlay) */}
                    <div className="absolute inset-0 z-10 opacity-60">
                        {topError ? (
                            // Error placeholder hidden to keep design clean if back.png works, or show subtle text
                             <div className="hidden"></div>
                        ) : (
                            <img 
                                src="top.png" 
                                alt="Title Main Visual" 
                                className={`w-full h-full object-cover transition-opacity duration-1000 ${topLoaded ? 'opacity-100' : 'opacity-0'}`}
                            />
                        )}
                    </div>
                    
                    {/* Layer 2: UI Content - 1„Å§Ââç„ÅÆ‰ªïÊßò„Å´Êàª„Åô (Text Title & Button) */}
                    <div className="relative z-20 text-center p-8 bg-black/40 backdrop-blur-sm rounded-xl border border-white/10 fade-in">
                        <h1 className="text-4xl md:text-6xl font-bold text-white mb-2 tracking-widest shadow-lg drop-shadow-md">
                            NOVEL GAME
                        </h1>
                        <p className="text-gray-300 mb-8 text-sm tracking-wider drop-shadow-sm">SCROLL INTERACTIVE FICTION</p>
                        
                        <button 
                            onClick={onStart}
                            className="group relative px-8 py-3 bg-white text-black font-serif font-bold text-lg tracking-widest hover:bg-gray-200 transition-all duration-300 transform hover:scale-105 shadow-lg"
                        >
                            Game Start
                            <div className="absolute inset-0 border border-white transform translate-x-1 translate-y-1 group-hover:translate-x-2 group-hover:translate-y-2 transition-transform duration-300 pointer-events-none"></div>
                        </button>
                    </div>
                </div>
            );
        };

        // --- „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà: „Ç≤„Éº„É†Êú¨Á∑® ---
        const GameScreen = () => {
            const lines = useMemo(() => parseNovelText(novelTextRaw), []);
            const [currentImageId, setCurrentImageId] = useState(lines[0]?.imageId || 1);
            const [loadedImage, setLoadedImage] = useState(null);
            const [imageError, setImageError] = useState(false);
            const scrollContainerRef = useRef(null);
            const lineRefs = useRef([]);
            const keysPressed = useRef(new Set());
            const animationFrameId = useRef(null);

            // „Çπ„ÇØ„É≠„Éº„É´Âà§ÂÆö
            const handleScroll = () => {
                if (!scrollContainerRef.current) return;
                const container = scrollContainerRef.current;
                const containerCenter = container.scrollTop + (container.clientHeight / 2);
                
                let activeLineIndex = 0;
                for (let i = 0; i < lines.length; i++) {
                    const el = lineRefs.current[i];
                    if (el) {
                        const { offsetTop, offsetHeight } = el;
                        if (offsetTop <= containerCenter && (offsetTop + offsetHeight) > containerCenter) {
                            activeLineIndex = i;
                            break;
                        }
                        if (offsetTop < containerCenter) {
                            activeLineIndex = i;
                        }
                    }
                }
                const newImageId = lines[activeLineIndex].imageId;
                if (newImageId !== currentImageId) {
                    setCurrentImageId(newImageId);
                    setImageError(false);
                }
            };

            // „Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú
            useEffect(() => {
                const SCROLL_SPEED = 15;
                const scrollLoop = () => {
                    if (!scrollContainerRef.current) return;
                    let move = 0;
                    if (keysPressed.current.has('ArrowDown')) move += SCROLL_SPEED;
                    if (keysPressed.current.has('ArrowUp')) move -= SCROLL_SPEED;

                    if (move !== 0) {
                        scrollContainerRef.current.scrollTop += move;
                        animationFrameId.current = requestAnimationFrame(scrollLoop);
                    } else {
                        animationFrameId.current = null;
                    }
                };
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (!keysPressed.current.has(e.key)) {
                            keysPressed.current.add(e.key);
                            if (!animationFrameId.current) scrollLoop();
                        }
                    }
                };
                const handleKeyUp = (e) => {
                    if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                        keysPressed.current.delete(e.key);
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                window.addEventListener('keyup', handleKeyUp);
                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                    window.removeEventListener('keyup', handleKeyUp);
                    if (animationFrameId.current) cancelAnimationFrame(animationFrameId.current);
                };
            }, []);

            // ÁîªÂÉèË™≠„ÅøËæº„Åø
            useEffect(() => {
                const img = new Image();
                const src = `${currentImageId}.png`;
                img.src = src;
                img.onload = () => {
                    setLoadedImage(src);
                    setImageError(false);
                };
                img.onerror = () => {
                    setLoadedImage(null);
                    setImageError(true);
                };
            }, [currentImageId]);

            return (
                <div className="flex flex-col md:flex-row h-screen w-full bg-gray-900 overflow-hidden fade-in">
                    {/* Left: Image */}
                    <div className="w-full md:w-1/2 h-1/3 md:h-full relative flex items-center justify-center bg-black border-b md:border-b-0 md:border-r border-gray-800 z-10">
                        <div className="absolute inset-0 flex items-center justify-center p-4">
                            {imageError ? (
                                <div className="text-center p-4 text-gray-500 select-none">
                                    <div className="text-4xl mb-2">üñºÔ∏è</div>
                                    <p className="text-lg font-bold">Image Not Found</p>
                                    <p className="text-sm font-mono bg-gray-800 px-2 py-1 rounded mt-2 inline-block">{currentImageId}.png</p>
                                </div>
                            ) : (
                                <img 
                                    src={loadedImage || ""} 
                                    alt={`Scene ${currentImageId}`}
                                    className={`max-w-full max-h-full object-contain transition-opacity duration-500 ${loadedImage ? 'opacity-100' : 'opacity-0'}`}
                                />
                            )}
                        </div>
                        <div className="absolute top-4 left-4 bg-black/50 text-white/50 text-xs px-2 py-1 rounded backdrop-blur-sm select-none">SCENE: {currentImageId}</div>
                    </div>

                    {/* Right: Text */}
                    <div 
                        className="w-full md:w-1/2 h-2/3 md:h-full overflow-y-auto relative scroll-smooth"
                        ref={scrollContainerRef}
                        onScroll={handleScroll}
                        tabIndex="0" 
                    >
                        <div className="min-h-full py-[50vh]">
                            <div className="max-w-2xl mx-auto px-6 md:px-12">
                                {lines.map((lineData, index) => (
                                    <p 
                                        key={index}
                                        ref={el => lineRefs.current[index] = el}
                                        className={`text-lg md:text-xl leading-relaxed mb-6 transition-colors duration-300 cursor-default ${lineData.imageId === currentImageId ? 'text-white opacity-100' : 'text-gray-400 opacity-60'} ${!lineData.text.trim() ? 'h-6' : ''}`}
                                    >
                                        {lineData.text || "\u00A0"}
                                    </p>
                                ))}
                            </div>
                        </div>
                        <div className="fixed bottom-4 right-6 md:right-12 text-gray-600 opacity-30 pointer-events-none text-sm hidden md:block">
                            Scroll or Press <span className="border border-gray-600 rounded px-1">‚Üë</span> <span className="border border-gray-600 rounded px-1">‚Üì</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- „É°„Ç§„É≥„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà ---
        const App = () => {
            const [isPlaying, setIsPlaying] = useState(false);

            return (
                <div className="w-full h-full">
                    {isPlaying ? (
                        <GameScreen />
                    ) : (
                        <TitleScreen onStart={() => setIsPlaying(true)} />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>